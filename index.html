<!DOCTYPE html>
<html>
<head>
<title>Whitelist System</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #111;
        color: white;
        text-align: center;
        padding-top: 50px;
    }

    #passwordPopup, #adminPanel {
        display: none;
        position: fixed;
        top: 50%; 
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px;
        background: #222;
        color: white;
        border-radius: 10px;
        z-index: 9999;
        width: 300px;
        text-align: center;
        border: 2px solid #555;
    }

    input, button, select {
        padding: 10px;
        margin-top: 10px;
        border-radius: 6px;
        border: none;
        font-size: 16px;
    }

    button {
        background: #4b78ff;
        color: white;
        cursor: pointer;
    }
    button:hover {
        background: #3256c7;
    }

    #playMarioBtn {
        display: none;
        margin-top: 30px;
        padding: 15px 25px;
        background: red;
        font-size: 20px;
        color: white;
        border-radius: 10px;
        cursor: pointer;
    }
    #playMarioBtn:hover {
        background: darkred;
    }

    .adminPlayBtn {
        background: red !important;
    }

    .toggleOn {
        background: green !important;
    }
    .toggleOff {
        background: #4b78ff !important;
    }
</style>
</head>
<body>

<h1 id="lockedMessage">This site is locked. Press ; to enter password.</h1>

<!-- USER PLAY BUTTON -->
<button id="playMarioBtn" onclick="openProxyGame()">
    Play Mario
</button>

<!-- PASSWORD POPUP -->
<div id="passwordPopup">
    <h3>Enter Admin Password</h3>
    <input id="passwordInput" type="password" placeholder="Password">
    <br>
    <button onclick="checkPass()">Submit</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
    <h2>Admin Panel</h2>

    <!-- ADMIN PLAY BUTTON -->
    <button class="adminPlayBtn" onclick="openProxyGame()">
        Play Mario (Admin)
    </button>

    <h3 style="margin-top: 20px;">Whitelist Control</h3>

    <!-- NEW TOGGLE BUTTON -->
    <button id="allowToggle" class="toggleOff" onclick="togglePermanent()">
        Allow Everyone: OFF
    </button>

    <h3 style="margin-top: 15px;">Timed Access</h3>
    <select id="presetTime">
        <option value="5">Allow 5 minutes</option>
        <option value="15">Allow 15 minutes</option>
        <option value="30">Allow 30 minutes</option>
        <option value="45">Allow 45 minutes</option>
        <option value="60">Allow 60 minutes</option>
    </select>
    <button onclick="allowPreset()">Allow</button>

    <h3 style="margin-top: 15px;">Custom Access</h3>
    <input id="customMinutes" type="number" placeholder="Minutes">
    <button onclick="allowCustom()">Allow Custom Time</button>

    <br><br>
    <button onclick="closeAdmin()">Close</button>
</div>

<script>
// PASSWORD
const ADMIN_PASSWORD = "roongoon678";
const GAME_URL = "https://fr-mario.vercel.app";

// PROXY WINDOW FUNCTION
function openProxyGame() {
    let win = window.open("about:blank", "_blank");
    win.document.write(`<iframe src="${GAME_URL}" style="border:0; width:100vw; height:100vh;"></iframe>`);
    win.document.close();
}

// CHECK WHITELIST STATUS
function isAllowed() {
    let expire = localStorage.getItem("whitelist_expire");
    if (!expire) return false;
    return Date.now() < parseInt(expire);
}

// UPDATE UI
function updateLockState() {
    const lockedMessage = document.getElementById("lockedMessage");
    const playMarioBtn = document.getElementById("playMarioBtn");
    const allowToggle = document.getElementById("allowToggle");

    if (isAllowed()) {
        lockedMessage.innerText = "Site Unlocked!";
        playMarioBtn.style.display = "inline-block";

        allowToggle.innerText = "Allow Everyone: ON";
        allowToggle.classList.remove("toggleOff");
        allowToggle.classList.add("toggleOn");

    } else {
        lockedMessage.innerText = "This site is locked. Press ; to enter password.";
        playMarioBtn.style.display = "none";

        allowToggle.innerText = "Allow Everyone: OFF";
        allowToggle.classList.remove("toggleOn");
        allowToggle.classList.add("toggleOff");
    }
}

updateLockState();

// SHOW PASSWORD POPUP
document.addEventListener("keydown", e => {
    if (e.key === ";") {
        document.getElementById("passwordPopup").style.display = "block";
        document.getElementById("passwordInput").focus();
    }
});

// CHECK PASSWORD
function checkPass() {
    let input = document.getElementById("passwordInput").value;
    if (input === ADMIN_PASSWORD) {
        document.getElementById("passwordPopup").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
    } else {
        alert("Wrong password");
    }
}

// NEW PERMANENT TOGGLE
function togglePermanent() {
    const allowToggle = document.getElementById("allowToggle");

    if (isAllowed()) {
        // turn OFF
        localStorage.removeItem("whitelist_expire");
    } else {
        // turn ON
        localStorage.setItem("whitelist_expire", Date.now() + 365 * 24 * 60 * 60 * 1000);
    }

    updateLockState();
}

// PRESET TIME
function allowPreset() {
    let mins = parseInt(document.getElementById("presetTime").value);
    let expire = Date.now() + mins * 60000;
    localStorage.setItem("whitelist_expire", expire);
    updateLockState();
    alert(`Everyone allowed for ${mins} minutes`);
}

// CUSTOM TIME
function allowCustom() {
    let m = parseInt(document.getElementById("customMinutes").value);
    if (!m || m <= 0) return alert("Enter valid minutes");

    let expire = Date.now() + m * 60000;
    localStorage.setItem("whitelist_expire", expire);
    updateLockState();
    alert(`Everyone allowed for ${m} minutes`);
}

function closeAdmin() {
    document.getElementById("adminPanel").style.display = "none";
}
</script>

</body>
</html>
